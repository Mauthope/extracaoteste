<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulário com Dados da Planilha</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }
    #message {
      margin-top: 20px;
      padding: 10px;
      background-color: #e6f7e6;
      border: 1px solid #4CAF50;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Carregar Planilha e Preencher Formulário</h1>

  <input type="file" id="upload" accept=".xlsx">
  <button id="process">Carregar Dados</button>

  <form id="propriedadeForm">
    <div>
      <label for="nomePropriedade">Cliente:</label>
      <input type="text" id="nomePropriedade" name="nomePropriedade" required>
    </div>
    <div>
      <label for="dataVisita">Data de entrada:</label>
      <input type="date" id="dataVisita" name="dataVisita" required>
    </div>
    <div>
      <label for="producaoLeite">Código de Barras (L):</label>
      <input type="number" id="producaoLeite" name="producaoLeite" required>
    </div>
    <div>
      <label for="vacasLactacao">Descrição:</label>
      <input type="text" id="vacasLactacao" name="vacasLactacao" required>
    </div>
    <div>
      <label for="quantPrimiparas">MS(%):</label>
      <input type="number" id="quantPrimiparas" name="quantPrimiparas" step="0.1" required>
    </div>
    <div>
      <label for="mediaLeite">Umidade (%):</label>
      <input type="number" id="mediaLeite" name="mediaLeite" step="0.1" required>
    </div>
    <div>
      <label for="lote1">FDA (%):</label>
      <input type="number" id="lote1" name="lote1" step="0.1" required>
    </div>
    <div>
      <label for="lote2">FDNmo (%):</label>
      <input type="number" id="lote2" name="lote2" step="0.1" required>
    </div>
    <div>
      <label for="lote3">Lignina (%):</label>
      <input type="number" id="lote3" name="lote3" step="0.1" required>
    </div>
    <div>
      <label for="delMedio">Amido (%):</label>
      <input type="number" id="delMedio" name="delMedio" step="0.1" required>
    </div>
    <div>
      <label for="tmrComposicao">Proteína Bruta (%):</label>
      <input type="number" id="tmrComposicao" name="tmrComposicao" step="0.1" required>
    </div>
    <div>
      <label for="kgSilagem">PIDA (%):</label>
      <input type="number" id="kgSilagem" name="kgSilagem" step="0.1" required>
    </div>
    <div>
      <label for="kgFeno">PIDN (%):</label>
      <input type="number" id="kgFeno" name="kgFeno" step="0.1" required>
    </div>
    <div>
      <label for="kgPreSecado">Proteína Solúvel (%):</label>
      <input type="number" id="kgPreSecado" name="kgPreSecado" step="0.1" required>
    </div>
    <div>
      <label for="kgRacao">EE (%):</label>
      <input type="number" id="kgRacao" name="kgRacao" step="0.1" required>
    </div>
    <div>
      <label for="sobrasCoxo">Cinzas (%):</label>
      <input type="number" id="sobrasCoxo" name="sobrasCoxo" step="0.1" required>
    </div>
    <div>
      <label for="tempoSilagem">pH:</label>
      <input type="number" id="tempoSilagem" name="tempoSilagem" step="0.01" required>
    </div>
    <div>
      <label for="vacasPreParto">Ácido Láctico (%):</label>
      <input type="number" id="vacasPreParto" name="vacasPreParto" step="0.1" required>
    </div>
    <div>
      <label for="dietaPreParto">Ácido Acético (%):</label>
      <input type="number" id="dietaPreParto" name="dietaPreParto" step="0.1" required>
    </div>
    <div>
      <label for="escoreCocho">Ácido Butírico (%):</label>
      <input type="number" id="escoreCocho" name="escoreCocho" step="0.1" required>
    </div>
    <div>
      <label for="escoreCorporal">dFDNp 48h (%):</label>
      <input type="number" id="escoreCorporal" name="escoreCorporal" step="0.1" required>
    </div>
    <div>
      <label for="uFDN240h">uFDN 240h (%):</label>
      <input type="number" id="uFDN240h" name="uFDN240h" step="0.1" required>
    </div>
    <div>
      <label for="dig">Dig. In Situ Amido (%):</label>
      <input type="number" id="dig" name="dig" step="0.1" required>
    </div>
    <div>
      <label for="kd">Kd FDN (%/h):</label>
      <input type="number" id="kd" name="kd" step="0.1" required>
    </div>
    <div>
      <label for="kda">Kd Amido (%/h):</label>
      <input type="number" id="kda" name="kda" step="0.1" required>
    </div>
    <div>
      <label for="ndt">NDT (%):</label>
      <input type="number" id="ndt" name="ndt" step="0.1" required>
    </div>
    <div>
      <label for="milk">Milk/Ton (kg):</label>
      <input type="number" id="milk" name="milk" step="0.1" required>
    </div>
  </form>

  <div id="message"></div>

  <script>
  document.getElementById('process').addEventListener('click', () => {
    const fileInput = document.getElementById('upload');
    const file = fileInput.files[0];
    const messageElement = document.getElementById('message');

    if (!file) {
      alert('Por favor, selecione uma planilha.');
      return;
    }

    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];

        const mapping = {
          'A6': 'nomePropriedade',
          'F6': 'dataVisita',
          'H6': 'producaoLeite',
          'I6': 'vacasLactacao',
          'CN6': 'quantPrimiparas',
          'CO6': 'mediaLeite',
          'CP6': 'lote1',
          'CR6': 'lote2',
          'CS6': 'lote3',
          'CT6': 'delMedio',
          'DA6': 'tmrComposicao',
          'DD6': 'kgSilagem',
          'DE6': 'kgFeno',
          'DI6': 'kgPreSecado',
          'DQ6': 'kgRacao',
          'EG6': 'sobrasCoxo',
          'EM6': 'tempoSilagem',
          'EN6': 'vacasPreParto',
          'EO6': 'dietaPreParto',
          'EP6': 'escoreCocho',
          'FB6': 'escoreCorporal',
          'FL6': 'uFDN240h',
          'FV6': 'dig',
          'FY6': 'kd',
          'FZ6': 'kda',
          'GE6': 'ndt',
          'GF6': 'milk'
        };

        for (const [cell, fieldId] of Object.entries(mapping)) {
          const cellValue = sheet[cell]?.v;
          const field = document.getElementById(fieldId);

          if (field) {
            if (fieldId === 'dataVisita') {
              // Tratamento especial para datas
              if (typeof cellValue === 'string' && cellValue.includes('/')) {
                const [day, month, year] = cellValue.split('/').map(Number);
                field.value = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
              } else if (typeof cellValue === 'number') {
                const date = XLSX.SSF.parse_date_code(cellValue);
                field.value = `${date.y}-${String(date.m).padStart(2, '0')}-${String(date.d).padStart(2, '0')}`;
              } else {
                field.value = '';
              }
            } else {
              // Para outros campos
              field.value = cellValue !== undefined ? cellValue : '';
            }
          }
        }

        messageElement.textContent = 'Dados carregados na íntegra da planilha!';
        messageElement.style.display = 'block';
        messageElement.style.backgroundColor = '#e6f7e6';
        messageElement.style.border = '1px solid #4CAF50';
      } catch (error) {
        console.error('Erro ao processar a planilha:', error);
        messageElement.textContent = 'Erro ao carregar os dados da planilha. Verifique o arquivo e tente novamente.';
        messageElement.style.display = 'block';
        messageElement.style.backgroundColor = '#f8d7da';
        messageElement.style.border = '1px solid #f5c6cb';
      }
    };

    reader.readAsArrayBuffer(file);
  });
</script>

</body>
</html>
