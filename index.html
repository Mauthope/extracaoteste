<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulário com Dados da Planilha</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Carregar Planilha e Preencher Formulário</h1>

  <input type="file" id="upload" accept=".xlsx">
  <button id="process">Carregar Dados</button>

  <form id="propriedadeForm">
    <label for="nomePropriedade">Cliente:</label>
    <input type="text" id="nomePropriedade" name="nomePropriedade" required>

    <label for="dataVisita">Data de entrada:</label>
    <input type="date" id="dataVisita" name="dataVisita" required>

    <label for="producaoLeite">Código de Barras (L):</label>
    <input type="number" id="producaoLeite" name="producaoLeite" required>

    <label for="vacasLactacao">Descrição:</label>
    <input type="number" id="vacasLactacao" name="vacasLactacao" required>

    <label for="quantPrimiparas">MS(%):</label>
    <input type="number" id="quantPrimiparas" name="quantPrimiparas" required>

    <label for="mediaLeite">Umidade (%):</label>
    <input type="number" id="mediaLeite" name="mediaLeite" step="0.1" required>

    <label for="lote1">FDA (%):</label>
    <input type="number" id="lote1" name="lote1" required>

    <label for="lote2">FDNmo (%):</label>
    <input type="number" id="lote2" name="lote2" required>

    <label for="lote3">Lignina (%):</label>
    <input type="number" id="lote3" name="lote3" required>

    <label for="delMedio">Amido (%):</label>
    <input type="number" id="delMedio" name="delMedio" required>

    <label for="tmrComposicao">Proteína Bruta (%):</label>
    <input type="text" id="tmrComposicao" name="tmrComposicao" required>

    <label for="kgSilagem">PIDA (%):</label>
    <input type="number" id="kgSilagem" name="kgSilagem" step="0.1" required>

    <label for="kgFeno">PIDN (%):</label>
    <input type="number" id="kgFeno" name="kgFeno" step="0.1" required>

    <label for="kgPreSecado">Proteína Solúvel (%):</label>
    <input type="number" id="kgPreSecado" name="kgPreSecado" step="0.1" required>

    <label for="kgRacao">EE (%):</label>
    <input type="number" id="kgRacao" name="kgRacao" step="0.1" required>

    <label for="sobrasCoxo">Cinzas (%):</label>
    <input type="number" id="sobrasCoxo" name="sobrasCoxo" step="0.1" required>

    <label for="tempoSilagem">pH:</label>
    <input type="number" id="tempoSilagem" name="tempoSilagem" required>

    <label for="vacasPreParto">Ácido Láctico (%):</label>
    <input type="number" id="vacasPreParto" name="vacasPreParto" required>

    <label for="dietaPreParto">Ácido Acético (%):</label>
    <input type="number" id="dietaPreParto" name="dietaPreParto" required>

    <label for="escoreCocho">Ácido Butírico (%):</label>
    <input type="number" id="escoreCocho" name="escoreCocho" step="0.1" required>

    <label for="escoreCorporal">dFDNp 48h (%):</label>
    <input type="number" id="escoreCorporal" name="escoreCorporal" step="0.1" required>

    <label for="uFDN240h">uFDN 240h (%):</label>
    <input type="number" id="uFDN240h" name="uFDN240h" step="0.1" required>

    <label for="dig">Dig. In Situ Amido (%):</label>
    <input type="number" id="dig" name="dig" step="0.1" required>

    <label for="kd">Kd FDN (%/h):</label>
    <input type="number" id="kd" name="kd" step="0.1" required>

    <label for="kda">Kd Amido (%/h):</label>
    <input type="number" id="kda" name="kda" step="0.1" required>

    <label for="ndt">NDT (%):</label>
    <input type="number" id="ndt" name="ndt" step="0.1" required>

    <label for="milk">Milk/Ton (kg):</label>
    <input type="number" id="milk" name="milk" step="0.1" required>
  </form>

  <script>
    document.getElementById('process').addEventListener('click', () => {
      const fileInput = document.getElementById('upload');
      const file = fileInput.files[0];

      if (!file) {
        alert('Por favor, selecione uma planilha.');
        return;
      }

      const reader = new FileReader();
      reader.onload = (event) => {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];

        // Mapeamento das células para os campos do formulário
        const mapping = {
          'A6': 'nomePropriedade',
          'F6': 'dataVisita',
          'H6': 'producaoLeite',
          'I6': 'vacasLactacao',
          'CN6': 'quantPrimiparas',
          'CO6': 'mediaLeite',
          'CP6': 'lote1',
          'CR6': 'lote2',
          'CS6': 'lote3',
          'CT6': 'delMedio',
          'DA6': 'tmrComposicao',
          'DD6': 'kgSilagem',
          'DE6': 'kgFeno',
          'DI6': 'kgPreSecado',
          'DQ6': 'kgRacao',
          'EG6': 'sobrasCoxo',
          'EM6': 'tempoSilagem',
          'EN6': 'vacasPreParto',
          'EO6': 'dietaPreParto',
          'EP6': 'escoreCocho',
          'FB6': 'escoreCorporal',
          'FL6': 'uFDN240h',
          'FV6': 'dig',
          'FY6': 'kd',
          'FZ6': 'kda',
          'GE6': 'ndt',
          'GF6': 'milk'
        };

        for (const [cell, fieldId] of Object.entries(mapping)) {
          const cellValue = sheet[cell]?.v;
          const field = document.getElementById(fieldId);

          if (field) {
            if (field.type === 'date') {
              field.value = new Date((cellValue - 25569) * 86400 * 1000).toISOString().split('T')[0]; // Excel date
            } else {
              field.value = cellValue || '';
            }
          }
        }
      };

      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
